<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Produits AliExpress Triés par Prix</title>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style>
    table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
        padding: 8px;
        text-align: left;
    }
    table {
        width: 100%;
    }
    form {
        margin-bottom: 20px;
    }
</style>
</head>
<body>
<h1>Produits de AliExpress (Triés par Prix)</h1>
<form id="searchForm">
    <label for="itemTitle">Titre du produit:</label>
    <input type="text" id="itemTitle" name="itemTitle" value="glasses">
    <label for="maxPrice">Prix Maximum:</label>
    <input type="number" id="maxPrice" name="maxPrice" value="5000">
    <button type="button" onclick="fetchProducts()">Rechercher</button>
</form>
<table id="productsTable">
    <tr>
        <th>Titre</th>
        <th>Prix (en Euros)</th>
        <th>URL</th>
    </tr>
</table>

<script>
function fetchProducts() {
    const itemTitle = document.getElementById('itemTitle').value;
    const maxPrice = document.getElementById('maxPrice').value;

    const apiUrl = "https://otapi-aliexpress.p.rapidapi.com/BatchSearchItemsFrame";
    const params = new URLSearchParams({
        language: "fr",
        framePosition: "0",
        frameSize: "14",
        ItemTitle: itemTitle,
        OrderBy: "Popularity:Desc",
        MaxPrice: maxPrice,
        currency: 'EUR'  // Assurez-vous que l'API prend en charge ce paramètre pour la monnaie
    });

    const headers = {
        "X-RapidAPI-Key": "b9ee6a42a7mshe7386d9bc393dadp14419fjsn8ae618abbf42",
        "X-RapidAPI-Host": "otapi-aliexpress.p.rapidapi.com"
    };

    axios.get(`${apiUrl}?${params}`, { headers })
        .then(response => {
            const products = response.data.Result.Items.Items.Content;
            products.sort((a, b) => parseFloat(a.Price.ConvertedPriceWithoutSign) - parseFloat(b.Price.ConvertedPriceWithoutSign));
            const table = document.getElementById("productsTable");
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }
            products.forEach(product => {
                if (!product.HasError) {
                    const row = table.insertRow();
                    const titleCell = row.insertCell(0);
                    const priceCell = row.insertCell(1);
                    const urlCell = row.insertCell(2);

                    titleCell.textContent = product.Title;
                    priceCell.textContent = product.Price.ConvertedPrice; // Affichage en euros
                    const link = document.createElement('a');
                    link.href = product.ExternalItemUrl;
                    link.textContent = "Voir produit";
                    link.target = "_blank";
                    urlCell.appendChild(link);
                }
            });
        })
        .catch(error => {
            console.error("Failed to retrieve data:", error);
        });
}


</script>
</body>
</html>
