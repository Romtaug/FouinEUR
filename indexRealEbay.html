<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Produits eBay Triés par Prix</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 8px;
            text-align: left;
        }
        table {
            width: 100%;
        }
        form {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<h1>Produits eBay (Triés par prix)</h1>
<form id="searchForm">
    <label for="itemTitle">Nom du produit :</label>
    <input type="text" id="itemTitle" name="itemTitle" required value="lunettes">
    <button type="button" onclick="fetchProducts()">Chercher</button>
</form>
<table id="productsTable">
    <thead>
        <tr>
            <th>Nom</th>
            <th>Prix</th>
            <th>Lien</th>
        </tr>
    </thead>
    <tbody>
        <!-- Les résultats de la recherche seront insérés ici -->
    </tbody>
</table>

<script>
    function fetchProducts() {
        const itemTitle = document.getElementById('itemTitle').value;
        const apiUrl = "https://ebay-data-scraper.p.rapidapi.com/products";
        const params = {
            page_number: "1",
            product_name: itemTitle
        };
    
        const headers = {
            "X-RapidAPI-Key": "b9ee6a42a7mshe7386d9bc393dadp14419fjsn8ae618abbf42",
            "X-RapidAPI-Host": "ebay-data-scraper.p.rapidapi.com"
        };
    
        axios.get(apiUrl, { headers: headers, params: params })
            .then(response => {
                let products = response.data;
                
                products = products.map(product => {
                    const priceString = product.price.split(' to ')[0].replace(/[^\d.]/g, '');
                    return {
                        ...product,
                        price: parseFloat(priceString),
                        currency: 'USD' // Utilisez la devise appropriée ici
                    };
                });
    
                products.sort((a, b) => a.price - b.price);
    
                const tableBody = document.querySelector('#productsTable tbody');
                tableBody.innerHTML = ''; // On efface les lignes précédentes
    
                products.forEach(product => {
                    const row = tableBody.insertRow();
                    const nameCell = row.insertCell(0);
                    const priceCell = row.insertCell(1);
                    const linkCell = row.insertCell(2);
    
                    nameCell.textContent = product.name;
                    priceCell.textContent = `${product.price.toFixed(2)} ${product.currency}`;
                    const link = document.createElement('a');
                    link.href = product.link;
                    link.textContent = product.link; // Affiche l'URL complète
                    link.target = "_blank";
                    linkCell.appendChild(link);
                });
            })
            .catch(error => {
                console.error("Erreur de récupération des données :", error);
            });
    }
    </script>
    
</body>
</html>
